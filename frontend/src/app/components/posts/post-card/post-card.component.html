<div class="post-card">
  <div class="post-header">
    <div class="user-group" (click)="profileClick.emit(post)">
      <div class="avatar-container">
        <img *ngIf="post.authorPhotoBase64; else initialFallback"
             [src]="profileService.getAvatarSrc(post.authorPhotoBase64)"
             class="avatar-img"
             alt="avatar">
        <ng-template #initialFallback>
          <div class="initials">{{ getInitials(post.authorUserName || '') }}</div>
        </ng-template>
      </div>
      <div class="meta-info">
        <span class="username">{{ post.authorUserName || 'unknown' }}</span>
        <span class="date">{{ post.createdAt | relativeTime }}</span>
      </div>
    </div>
  </div>

  <div class="post-media" *ngIf="post.image" (click)="toggleLike()">
    <div class="image-container">
      <img [src]="'data:image/jpeg;base64,' + post.image" [alt]="post.title">
    </div>
  </div>

  <div class="post-actions-bar">
    <div class="actions-left">

      <button class="action-btn like-btn"
              [class.active]="isLiked"
              (click)="toggleLike()"
              title="Like">
        <span class="icon-box">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" d="M21 8.25c0-2.485-2.099-4.5-4.688-4.5-1.935 0-3.597 1.126-4.312 2.733-.715-1.607-2.377-2.733-4.313-2.733C5.1 3.75 3 5.765 3 8.25c0 7.22 9 12 9 12s9-4.78 9-12z" />
          </svg>
        </span>
        <span class="count-label" [class.hidden]="likesCount === 0">{{ likesCount }}</span>
      </button>

      <button class="action-btn comment-btn" (click)="toggleComments()" title="Comment">
        <span class="icon-box">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" d="M12 20.25c4.97 0 9-3.694 9-8.25s-4.03-8.25-9-8.25S3 7.444 3 12c0 2.104.859 4.023 2.273 5.48.432.447.74 1.04.586 1.641a4.483 4.483 0 01-.923 1.785A5.969 5.969 0 006 21c1.282 0 2.47-.402 3.445-1.087.81.22 1.668.337 2.555.337z" />
          </svg>
        </span>
        <span class="count-label">{{ commentsCount || comments?.length || 0 }}</span>
      </button>

    </div>
  </div>

  <div class="post-content">
    <div class="caption-block">
      <h3 class="post-title" *ngIf="post.title">{{ post.title }}</h3>
      <p class="post-text">
        <span class="author-name-inline">{{ post.authorUserName }}</span>
        {{ post.content }}
      </p>
    </div>

    <div class="view-comments-link" *ngIf="!showComments && (commentsCount > 0 || (comments && comments.length > 0))" (click)="toggleComments()">
      View all comments
    </div>
  </div>

  <div class="comments-section" *ngIf="showComments">
    <div class="comments-list">
      <div *ngIf="isLoadingComments" class="loading-sm">Updating...</div>
      <div class="comment-item" *ngFor="let comment of comments">
        <span class="c-user">{{ comment.userName }}</span>
        <span class="c-text">{{ comment.text }}</span>
      </div>
    </div>

    <div class="comment-input-wrapper">
      <input type="text"
             placeholder="Add a comment..."
             [(ngModel)]="newCommentText"
             (keydown.enter)="sendComment()">
      <button class="post-link-btn" [disabled]="!newCommentText.trim()" (click)="sendComment()">
        Post
      </button>
    </div>
  </div>
</div>
